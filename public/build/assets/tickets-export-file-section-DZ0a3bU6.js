import{r as j,j as P}from"./page-DYpLzGDn.js";import{e as B}from"./tickets-service-D5Iq8Wjr.js";import{u,w as I}from"./xlsx-769MyM77.js";import{u as O}from"./app-CDWaUar6.js";import{h as n}from"./page-CZJkV9Z0.js";import{B as $}from"./button-DpuTG-UI.js";import{R as z}from"./FileDoneOutlined-DGt8qESf.js";import"./index-DaPaTlHv.js";import"./asyncToGenerator-C4ZkcmSA.js";import"./compact-item-F-iihlo1.js";import"./render-DDfW_aRt.js";function et(){const[R,c]=j.useState(!1);O(a=>a.tickets);const L=new URLSearchParams(window.location.search).get("search"),q=a=>{if(!a)return"N/A";const l=a.replace(/[^\d]/g,"");return l.length!==10?"N/A":l.replace(/(\d{3})(\d{3})(\d{4})/,"($1) $2-$3")};async function E(){c(!0);try{const a=await B(window.location.search);async function l(){const d=a.data;c(!1),console.log("allTickets",d);let r=[],o=[];L=="RESOURCE"?(r=d.map(t=>{var e,i;return[n((e=t==null?void 0:t.receipt)==null?void 0:e.updated_at).format("L"),t.ticket_id,((i=t.validator)==null?void 0:i.name)??"N/A"]}),r.sort((t,e)=>new Date(t[0])-new Date(e[0])),o=[["Validated Date","Ticket Number","Agent Name"],...r]):(r=d.map(t=>{var p,f,_,A,N,h,g,k,w,y,S,C,D,x;const e=[...t==null?void 0:t.agent_notes,...t==null?void 0:t.cases_logs],i=e.reduce((F,b)=>n(b.created_at).isAfter(n(F))?b.created_at:F,(p=e[0])==null?void 0:p.created_at);console.log("resss",t);const U=t;return[n(t.created_at).format("L"),n(i).format("L"),t.ticket_id??"N/A",t.fname??"N/A",t.lname??"N/A",q(t.phone),t.email??"N/A",t.serial_number??"N/A",t.item_number??"N/A",t.unit??"N/A",t.class??"N/A",t.brand??"N/A",t.call_type??"N/A",t.purchase_date??"N/A",t.zip_code??"N/A",t.country??"N/A",t.state??"N/A",t.city??"N/A",t.address??"N/A",t.issue??"N/A",t.status??"N/A",t.reason_to_close??"N/A",((f=t.receipt)==null?void 0:f.discount)??"N/A",((_=t.decision_making)==null?void 0:_.after_discount)??"N/A",((A=t.receipt)==null?void 0:A.retailers_price)??"N/A",((N=t.decision_making)==null?void 0:N.cost_of_unit)??"0",((h=t.decision_making)==null?void 0:h.shipping_cost)??"0",((g=t.replacement)==null?void 0:g.ship_date)??"N/A",((k=t.replacement)==null?void 0:k.tracking)??"N/A",((w=t.refund)==null?void 0:w.ship_date)??"N/A",((y=t.refund)==null?void 0:y.cheque_no)??"N/A",((S=t.refund)==null?void 0:S.cheque_amount)??"0",(t.country=="CA"?"CAD":"USD")??"N/A",((C=t.receipt)==null?void 0:C.store)??"N/A","No",(t.isUploading=="true"?"YES":"NO")??"NO",t.status??"N/A",(D=t==null?void 0:t.validate)!=null&&D.created_at?n((x=t==null?void 0:t.validate)==null?void 0:x.created_at).format("L"):"N/A"]}),o=[["Date Created","Date Last Updated","Ticket #","First Name","Last Name","Phone","Email","Serial #","Model #","Unit","Item Class","Brand","Resolution","Purchase Date","Zipcode","Country","State","City","Address","Issue","Ticket Status","Reason","Discount","Price After Discount","Purchase Price","Cost Price","Shipping Cost","Replacement Ship Date","Tracking #","Cheque Ship Date","Cheque #","Cheque Amount","Cheque Currency","Retail Store","From Parts","Is Downloaded","Warranty Decision","Validation Date"],...r]),console.log("export_data",o);const s=u.aoa_to_sheet(o),T={font:{bold:!0,color:{rgb:"FFFFFF"}},fill:{fgColor:{rgb:"2F75B5"}}};for(let t=0;t<o[0].length;t++){const e=u.encode_cell({r:0,c:t});s[e]||(s[e]={}),s[e].s=T}const v=o[0].map((t,e)=>Math.max(...o.map(i=>(i[e]?i[e].toString():"").length)));s["!cols"]=v.map(t=>({wch:t+2}));const m=u.book_new();u.book_append_sheet(m,s,"Sheet1"),I(m,new Date().getTime()+".xlsx")}a.result=="unexist"?(await l(),c(!1)):(await l(),c(!1))}catch{c(!1)}}return P.jsx($,{loading:R,onClick:E,type:"primary",size:"large",icon:P.jsx(z,{}),children:"Export File"})}export{et as default};

import{r as B,j as v,s as I}from"./page-Dvv0qJ3J.js";import{g as O}from"./tickets-thunk-BLFQti8N.js";import{u as d,w as $}from"./xlsx-769MyM77.js";import{u as z}from"./app-BC-xPeh5.js";import{v as M,b as V}from"./tickets-service-BEVgERZQ.js";import{h as n}from"./page-BAw4YptE.js";import{B as W}from"./button-B9bgOgSI.js";import{R as Q}from"./FileDoneOutlined-CRuqFLzj.js";import"./internals-service-B9kSbxh_.js";import"./index-Dhfa0PVB.js";import"./asyncToGenerator-DcycdJ4S.js";import"./compact-item-DPKWq_r-.js";import"./render-Qf48jvG_.js";function rt(){const[R,c]=B.useState(!1);z(i=>i.tickets);const L=new URLSearchParams(window.location.search).get("search"),T=i=>{if(!i)return"N/A";const r=i.replace(/[^\d]/g,"");return r.length!==10?"N/A":r.replace(/(\d{3})(\d{3})(\d{4})/,"($1) $2-$3")};async function q(){c(!0);try{const i=await I.dispatch(O(window.location.search)),r=await M(window.location.search);async function u(){const m=r.data;c(!1),console.log("allTickets",m);let s=[],a=[];L=="RESOURCE"?(s=m.map(t=>{var e,o;return[n((e=t==null?void 0:t.receipt)==null?void 0:e.updated_at).format("L"),t.ticket_id,((o=t.validator)==null?void 0:o.name)??"N/A"]}),s.sort((t,e)=>new Date(t[0])-new Date(e[0])),a=[["Validated Date","Ticket Number","Agent Name"],...s]):(s=m.map(t=>{var _,f,A,h,N,g,w,k,y,S,C,D,x,F;const e=[...t==null?void 0:t.agent_notes,...t==null?void 0:t.cases_logs],o=e.reduce((b,P)=>n(P.created_at).isAfter(n(b))?P.created_at:b,(_=e[0])==null?void 0:_.created_at);console.log("resss",t);const j=t;return[n(t.created_at).format("L"),n(o).format("L"),t.ticket_id??"N/A",t.fname??"N/A",t.lname??"N/A",T(t.phone),t.email??"N/A",t.serial_number??"N/A",t.item_number??"N/A",t.unit??"N/A",t.class??"N/A",t.brand??"N/A",t.call_type??"N/A",t.purchase_date??"N/A",t.zip_code??"N/A",t.country??"N/A",t.state??"N/A",t.city??"N/A",t.address??"N/A",t.issue??"N/A",t.status??"N/A",t.reason_to_close??"N/A",((f=t.receipt)==null?void 0:f.discount)??"N/A",((A=t.decision_making)==null?void 0:A.after_discount)??"N/A",((h=t.receipt)==null?void 0:h.retailers_price)??"N/A",((N=t.decision_making)==null?void 0:N.cost_of_unit)??"0",((g=t.decision_making)==null?void 0:g.shipping_cost)??"0",((w=t.replacement)==null?void 0:w.ship_date)??"N/A",((k=t.replacement)==null?void 0:k.tracking)??"N/A",((y=t.refund)==null?void 0:y.ship_date)??"N/A",((S=t.refund)==null?void 0:S.cheque_no)??"N/A",((C=t.refund)==null?void 0:C.cheque_amount)??"N/A",(t.country=="CA"?"CAD":"USD")??"N/A",((D=t.receipt)==null?void 0:D.store)??"N/A","No",(t.isUploading=="true"?"YES":"NO")??"NO",t.status??"N/A",(x=t==null?void 0:t.validate)!=null&&x.created_at?n((F=t==null?void 0:t.validate)==null?void 0:F.created_at).format("L"):"N/A"]}),a=[["Date Created","Date Last Updated","Ticket #","First Name","Last Name","Phone","Email","Serial #","Model #","Unit","Item Class","Brand","Resolution","Purchase Date","Zipcode","Country","State","City","Address","Issue","Ticket Status","Reason","Discount","Price After Discount","Purchase Price","Cost Price","Shipping Cost","Replacement Ship Date","Tracking #","Cheque Ship Date","Cheque #","Cheque Amount","Cheque Currency","Retail Store","From Parts","Is Downloaded","Warranty Decision","Validation Date"],...s]),console.log("export_data",a);const l=d.aoa_to_sheet(a),E={font:{bold:!0,color:{rgb:"FFFFFF"}},fill:{fgColor:{rgb:"2F75B5"}}};for(let t=0;t<a[0].length;t++){const e=d.encode_cell({r:0,c:t});l[e]||(l[e]={}),l[e].s=E}const U=a[0].map((t,e)=>Math.max(...a.map(o=>(o[e]?o[e].toString():"").length)));l["!cols"]=U.map(t=>({wch:t+2}));const p=d.book_new();d.book_append_sheet(p,l,"Sheet1"),$(p,new Date().getTime()+".xlsx")}r.result=="unexist"?(u(),V(window.location.search)):(window.confirm("The File is already downloaded. Press ok to continue to download")&&u(),c(!1))}catch{c(!1)}}return v.jsx(W,{loading:R,onClick:q,type:"primary",size:"large",icon:v.jsx(Q,{}),children:"Export File"})}export{rt as default};

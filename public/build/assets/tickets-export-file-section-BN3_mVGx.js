import{r as O,j as s}from"./page-3qddC-Ic.js";import{e as $}from"./tickets-service-BYEPOVyf.js";import{u as m,w as z}from"./xlsx-D27o5enP.js";import{u as Q}from"./app-Cjp1xWbS.js";import{h as o}from"./page-Bts9TZWZ.js";import{B as V}from"./button-2JgxEJRi.js";import{R as W}from"./FileDoneOutlined-1-gZt-eL.js";import"./index-rStzQJdP.js";import"./asyncToGenerator-DKT1tr5Y.js";import"./compact-item-XisaMXzl.js";import"./render-Hzza5H2S.js";function it(){const[q,c]=O.useState(!1);Q(e=>e.tickets);const p=new URLSearchParams(window.location.search),_=p.get("search"),U=p.get("status"),v=e=>{if(!e)return"N/A";const l=e.replace(/[^\d]/g,"");return l.length!==10?"N/A":l.replace(/(\d{3})(\d{3})(\d{4})/,"($1) $2-$3")};async function j(){c(!0);try{const e=await $(window.location.search);async function l(){const u=e.data;c(!1),console.log("allTickets",u);let d=[],i=[];_=="RESOURCE"?(d=u.map(t=>{var a,n;return[o((a=t==null?void 0:t.receipt)==null?void 0:a.updated_at).format("L"),t.ticket_id,((n=t.validator)==null?void 0:n.name)??"N/A"]}),d.sort((t,a)=>new Date(t[0])-new Date(a[0])),i=[["Validated Date","Ticket Number","Agent Name"],...d]):(d=u.map(t=>{var A,N,h,g,k,D,w,y,C,S,x,F,E,L,P,R;const a=[...t==null?void 0:t.agent_notes,...t==null?void 0:t.cases_logs],n=a.reduce((b,T)=>o(T.created_at).isAfter(o(b))?T.created_at:b,(A=a[0])==null?void 0:A.created_at);console.log("resss",t);const M=t;return[o(t.created_at).format("L"),o(n).format("L"),t.ticket_id??"N/A",t.fname??"N/A",t.lname??"N/A",v(t.phone),t.email??"N/A",t.serial_number??"N/A",t.item_number??"N/A",t.unit??"N/A",t.class??"N/A",t.brand??"N/A",t.call_type??"N/A",t.purchase_date??"N/A",t.zip_code??"N/A",t.country??"N/A",t.state??"N/A",t.city??"N/A",t.address??"N/A",t.issue??"N/A",t.status??"N/A",t.reason_to_close??"N/A",((N=t.receipt)==null?void 0:N.discount)??"N/A",((h=t.decision_making)==null?void 0:h.after_discount)??"N/A",((g=t.receipt)==null?void 0:g.retailers_price)??"N/A",((k=t.decision_making)==null?void 0:k.cost_of_unit)??"0",((D=t.decision_making)==null?void 0:D.shipping_cost)??"0",((w=t.replacement)==null?void 0:w.ship_date)??"N/A",((y=t.replacement)==null?void 0:y.tracking)??"N/A",((C=t.refund)==null?void 0:C.ship_date)??"N/A",((S=t.refund)==null?void 0:S.cheque_no)??"N/A",((x=t.refund)==null?void 0:x.cheque_amount)??"0",(t.country=="CA"?"CAD":"USD")??"N/A",((F=t.receipt)==null?void 0:F.store)??"N/A","No",(t.isUploading=="true"?"YES":"NO")??"NO",t.status??"N/A",(E=t==null?void 0:t.validate)!=null&&E.created_at?o((L=t==null?void 0:t.validate)==null?void 0:L.created_at).format("L"):"N/A",(t==null?void 0:t.decision_status)=="REPLACEMENT"?o((P=t==null?void 0:t.replacement_shipped)==null?void 0:P.created_at).format("L"):(t==null?void 0:t.decision_status)=="REFUND"?o((R=t==null?void 0:t.refund_shipped)==null?void 0:R.created_at).format("L"):"N/A"]}),i=[["Date Created","Date Last Updated","Ticket #","First Name","Last Name","Phone","Email","Serial #","Model #","Unit","Item Class","Brand","Resolution","Purchase Date","Zipcode","Country","State","City","Address","Issue","Ticket Status","Reason","Discount","Price After Discount","Purchase Price","Cost Price","Shipping Cost","Replacement Ship Date","Tracking #","Cheque Ship Date","Cheque #","Cheque Amount","Cheque Currency","Retail Store","From Parts","Is Downloaded","Warranty Decision","Validation Date","Date Processed"],...d]),console.log("export_data",i);const r=m.aoa_to_sheet(i),B={font:{bold:!0,color:{rgb:"FFFFFF"}},fill:{fgColor:{rgb:"2F75B5"}}};for(let t=0;t<i[0].length;t++){const a=m.encode_cell({r:0,c:t});r[a]||(r[a]={}),r[a].s=B}const I=i[0].map((t,a)=>Math.max(...i.map(n=>(n[a]?n[a].toString():"").length)));r["!cols"]=I.map(t=>({wch:t+2}));const f=m.book_new();m.book_append_sheet(f,r,"Sheet1"),z(f,new Date().getTime()+".xlsx")}e.result=="unexist"?(await l(),c(!1)):(await l(),c(!1))}catch{c(!1)}}return s.jsx(s.Fragment,{children:(U||_)&&s.jsx(V,{loading:q,onClick:j,type:"primary",size:"large",icon:s.jsx(W,{}),children:"Export File"})})}export{it as default};

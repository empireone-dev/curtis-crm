import{V as E,r as R,j as C,s as q}from"./page-CHd1tz-i.js";import{u as d,w as v}from"./xlsx-D27o5enP.js";import{u as L}from"./app-BnrEFdFz.js";import{E as j,F as U,G as O}from"./tickets-service-CAgRt2C0.js";import{h as p}from"./page-DBrdwVtn.js";import{B}from"./button-DEsoexdW.js";import{R as W}from"./FileDoneOutlined-BojS3ZNU.js";function z(c){return async function(l,i){return await j(c)}}function Z(c){return async function(l,i){const m=await U(c);l(E.actions.setTickets(m))}}function I({account:c}){const[l,i]=R.useState(!1);L(a=>a.tickets);const b=new URLSearchParams(window.location.search).get("search"),x=a=>{if(!a)return"N/A";const r=a.replace(/[^\d]/g,"");return r.length!==10?"N/A":r.replace(/(\d{3})(\d{3})(\d{4})/,"($1) $2-$3")};async function F(){i(!0);try{const a=await q.dispatch(z(c.country));async function r(){const _=a.data;i(!1);let s=[],n=[];b=="RESOURCE"?(s=_.map(t=>{var e,o;return[p((e=t==null?void 0:t.receipt)==null?void 0:e.updated_at).format("L"),t.ticket_id,((o=t.validator)==null?void 0:o.name)??"N/A"]}),s.sort((t,e)=>new Date(t[0])-new Date(e[0])),n=[["Validated Date","Ticket Number","Agent Name"],...s]):(s=_.map(t=>{var e,o,f,N,A,g,w,k,y,S,D;return[p(t.created_at).format("L"),p(t.updated_at).format("L"),t.ticket_id??"N/A",t.fname??"N/A",t.lname??"N/A",x(t.phone),t.email??"N/A",t.serial_number??"N/A",t.item_number??"N/A",t.unit??"N/A",t.class??"N/A",t.brand??"N/A",t.call_type??"N/A",t.purchase_date??"N/A",t.zip_code??"N/A",t.country??"N/A",t.state??"N/A",t.city??"N/A",t.address??"N/A",t.issue??"N/A",t.status??"N/A",t.reason_to_close??"N/A",((e=t.receipt)==null?void 0:e.discount)??"N/A",((o=t.receipt)==null?void 0:o.retailers_price)??"N/A",((f=t.receipt)==null?void 0:f.total_price)??"N/A",((N=t.decision_making)==null?void 0:N.cost_of_unit)??"0",((A=t.decision_making)==null?void 0:A.shipping_cost)??"0",((g=t.replacement)==null?void 0:g.ship_date)??"N/A",((w=t.replacement)==null?void 0:w.tracking)??"N/A",((k=t.refund)==null?void 0:k.ship_date)??"N/A",((y=t.refund)==null?void 0:y.cheque_no)??"N/A",((S=t.refund)==null?void 0:S.cheque_amount)??"N/A",(t.country=="CA"?"CAD":"USD")??"N/A",((D=t.receipt)==null?void 0:D.store)??"N/A","No",(t.isUploading=="true"?"YES":"NO")??"NO",t.status??"N/A",p(t.updated_at).format("L")]}),n=[["Date Created","Date Last Updated","Ticket #","First Name","Last Name","Phone","Email","Serial #","Model #","Unit","Item Class","Brand","Resolution","Purchase Date","Zipcode","Country","State","City","Address","Issue","Ticket Status","Reason","Discount","Price After Discount","Purchase Price","Cost Price","Shipping Cost","Replacement Ship Date","Tracking #","Cheque Ship Date","Cheque #","Cheque Amount","Cheque Currency","Retail Store","From Parts","Is Downloaded","Warranty Decision","Validation Date"],...s]);const u=d.aoa_to_sheet(n),P={font:{bold:!0,color:{rgb:"FFFFFF"}},fill:{fgColor:{rgb:"2F75B5"}}};for(let t=0;t<n[0].length;t++){const e=d.encode_cell({r:0,c:t});u[e]||(u[e]={}),u[e].s=P}const T=n[0].map((t,e)=>Math.max(...n.map(o=>(o[e]?o[e].toString():"").length)));u["!cols"]=T.map(t=>({wch:t+2}));const h=d.book_new();d.book_append_sheet(h,u,"Sheet1"),v(h,new Date().getTime()+".xlsx")}a.result=="unexist"?(r(),O(window.location.search)):(window.confirm("The File is already downloaded. Press ok to continue to download")&&r(),i(!1))}catch{i(!1)}}return C.jsx(B,{loading:l,onClick:F,type:"primary",size:"large",icon:C.jsx(W,{}),children:"Export File"})}const J=Object.freeze(Object.defineProperty({__proto__:null,default:I},Symbol.toStringTag,{value:"Module"}));export{I as W,Z as g,J as w};

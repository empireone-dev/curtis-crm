import{r as d,j as e,s as E}from"./page-Dvv0qJ3J.js";import{u as J}from"./app-6_ioMWLI.js";import{v as K,u as Q}from"./tickets-service-DDpF8JLZ.js";import{u as l,w as X}from"./xlsx-769MyM77.js";import{h as p}from"./page-BAw4YptE.js";import{g as F}from"./tickets-thunk-DuYFR5Uo.js";import{B as _}from"./button-B9bgOgSI.js";import{M as Y}from"./index-D2WaOWHB.js";import{R as s}from"./index-BK11INfU.js";import{S as $}from"./index-CdWxde84.js";import{s as tt}from"./index-BuI6fbsm.js";import"./index-Dhfa0PVB.js";import"./internals-service-B9kSbxh_.js";import"./asyncToGenerator-DcycdJ4S.js";import"./compact-item-DPKWq_r-.js";import"./render-Qf48jvG_.js";import"./CheckCircleFilled-3_LZyTe3.js";import"./pickAttrs-De0fYBMX.js";import"./InfoCircleFilled-CmfHv0Zb.js";import"./useZIndex-CLajle8q.js";import"./motion-4S5rSXvC.js";import"./Modal-DiCHpgoh.js";import"./index-Drb4UXd2.js";import"./motion-5veK1EeG.js";import"./KeyCode-DNlgD2sM.js";import"./fade-B98zCcD8.js";import"./zoom-BftL7CzZ.js";import"./ContextIsolator-CrJxiWi5.js";import"./useClosable-CiaT9yUf.js";import"./useCSSVarCls-S3x8ZpMa.js";import"./useLocale-1Z1eSgrw.js";import"./PurePanel-D6VZOtkx.js";import"./index-C1NzuiIz.js";import"./Overflow-v3O2ihSo.js";import"./useIcons-CEWdcGBi.js";import"./CheckOutlined-DNVZ-6xJ.js";import"./DownOutlined-SD0MAX-D.js";function Ut({selected:at}){const[D,u]=d.useState(!1),[M,g]=d.useState(!1);J(o=>o.tickets);const[r,L]=d.useState("all"),[i,P]=d.useState([]),x=[{id:0,name:"Date Last Updated"},{id:1,name:"Ticket #"},{id:2,name:"Ticket Status"},{id:3,name:"Model #"},{id:4,name:"Item Class"},{id:5,name:"Price After Discount"},{id:6,name:"Cheque Currency"},{id:7,name:"Cost Price"},{id:8,name:"Shipping Cost"},{id:9,name:"First Name"},{id:10,name:"Last Name"},{id:11,name:"Address"},{id:12,name:"City"},{id:13,name:"State"},{id:14,name:"Zipcode"},{id:15,name:"Phone"},{id:16,name:"Email"},{id:17,name:"Serial #"},{id:18,name:"Retail Store"},{id:19,name:"Purchase Date"},{id:20,name:"Validated Date"}],R=o=>{console.log("selected ",o),P(o)},T=o=>{console.log("radio checked",o.target.value),L(o.target.value)},B=()=>{g(!0)};console.log("selectedColumn",i);const O=async()=>{if(i.length!=0){u(!0),console.log(window.location.search);const o=await K(window.location.search+"&export="+r);async function h(t){return o.data}async function U(t){return x.filter(a=>i.includes(a.id))}const V=(await h()).map(t=>{var f,w,C,N,S,v,y;const a=[...t==null?void 0:t.agent_notes,...t==null?void 0:t.cases_logs],n=a.reduce((b,j)=>p(j.created_at).isAfter(p(b))?j.created_at:b,(f=a[0])==null?void 0:f.created_at);return{0:{id:0,name:p(n).format("L")},1:{id:1,name:(t==null?void 0:t.ticket_id)??"N/A"},2:{id:2,name:(t==null?void 0:t.status)??"N/A"},3:{id:3,name:(t==null?void 0:t.item_number)??"N/A"},4:{id:4,name:(t==null?void 0:t.class)??"N/A"},5:{id:5,name:((w=t.decision_making)==null?void 0:w.after_discount)??"N/A"},6:{id:6,name:(t.country=="CA"?"CAD":"USD")??"N/A"},7:{id:7,name:((C=t.decision_making)==null?void 0:C.cost_of_unit)??"N/A"},8:{id:8,name:((N=t.decision_making)==null?void 0:N.shipping_cost)??"N/A"},9:{id:9,name:(t==null?void 0:t.fname)??"N/A"},10:{id:10,name:(t==null?void 0:t.lname)??"N/A"},11:{id:11,name:(t==null?void 0:t.address)??"N/A"},12:{id:12,name:(t==null?void 0:t.city)??"N/A"},13:{id:13,name:(t==null?void 0:t.state)??"N/A"},14:{id:14,name:(t==null?void 0:t.zip_code)??"N/A"},15:{id:15,name:(t==null?void 0:t.phone)??"N/A"},16:{id:16,name:(t==null?void 0:t.email)??"N/A"},17:{id:17,name:(t==null?void 0:t.serial_number)??"N/A"},18:{id:18,name:((S=t.receipt)==null?void 0:S.store)??"N/A"},19:{id:19,name:(t==null?void 0:t.purchase_date)??"N/A"},20:{id:0,name:(v=t==null?void 0:t.validate)!=null&&v.created_at?p((y=t==null?void 0:t.validate)==null?void 0:y.created_at).format("L"):"N/A"}}}),q=await U(),z=V.map(t=>i.map(a=>t[a])),G=i.map(t=>q.find(a=>a.id===t)),I=z.map(t=>i.map(a=>t.find(n=>n.id===a))),c=[G.map(t=>t.name),...I.map(t=>t.map(a=>a.name))];console.log("export_data",c);const m=l.aoa_to_sheet(c),W={font:{bold:!0,color:{rgb:"FFFFFF"}},fill:{fgColor:{rgb:"2F75B5"}}};for(let t=0;t<c[0].length;t++){const a=l.encode_cell({r:0,c:t});m[a]||(m[a]={}),m[a].s=W}const Z=c[0].map((t,a)=>Math.max(...c.map(n=>(n[a]?n[a].toString():"").length)));m["!cols"]=Z.map(t=>({wch:t+2}));const k=l.book_new();l.book_append_sheet(k,m,"Sheet1"),X(k,new Date().getTime()+".xlsx");const H=(await h()).map(t=>t.id);Q(H,r),window.location.hash==""?E.dispatch(F(window.location.search)):E.dispatch(F("?search="+window.location.hash.slice(1))),u(!1)}else tt.warning("Please select a column!")},A=()=>{g(!1)};return d.useEffect(()=>{u(!1)},[]),e.jsxs("div",{children:[e.jsx(_,{type:"primary",onClick:B,children:"Export Case Files"}),e.jsxs(Y,{title:"Export Data",open:M,footer:[e.jsx(_,{onClick:A,children:"Cancel"},"back"),e.jsx(_,{type:"primary",loading:D,onClick:O,children:"Submit"},"submit")],onCancel:A,children:[e.jsxs(s.Group,{onChange:T,value:r,children:[e.jsx(s,{value:"all",children:"Export All"}),e.jsx(s,{value:"checked",children:"Export Checked"}),e.jsx(s,{value:"uncheck",children:"Export Uncheck"})]}),e.jsx("div",{className:"font-bold py-2",children:"Select table column"}),e.jsx($,{mode:"tags",style:{width:"100%"},placeholder:"select column",onChange:R,tokenSeparators:[","],options:x.map((o,h)=>({value:o.id,label:o.name}))})]})]})}export{Ut as default};

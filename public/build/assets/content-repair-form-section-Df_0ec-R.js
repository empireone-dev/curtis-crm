import{r as p,j as a,y as L}from"./page-BNpu25Vy.js";import{I as H}from"./input-DYku2Z7a.js";import{T as J}from"./textarea-C4pOphf2.js";import{u as I,a as K}from"./app-BJI3E93v.js";import{L as P}from"./loading-Cp5UdgYS.js";import{r as N}from"./routing-BzgBYGmF.js";import{b as Q}from"./files-service-Cn9U5MlK.js";import{U as V}from"./index-BI2sgu9w.js";import{B as W}from"./button-CTMOoJJC.js";import{R as X}from"./UploadOutlined-CQU2hs8s.js";import{s as k}from"./index-VV0ePBQH.js";import"./index-oSI6-JwC.js";import"./asyncToGenerator-y2MD6EK_.js";import"./pickAttrs-RPHs8Lcg.js";import"./motion-DXIbP6aI.js";import"./compact-item-LZnqzSXy.js";import"./collapse-BbEVqHco.js";import"./useZIndex-BOlZ46cz.js";import"./fade-C3n7wJyI.js";import"./useForceUpdate-XwV0PwLd.js";import"./motion-4S5rSXvC.js";import"./DeleteOutlined-BwJD-I52.js";import"./EyeOutlined-DJNKto2k.js";import"./CheckCircleFilled-yDpF37j4.js";import"./CheckOutlined-BZZFPCFf.js";import"./index-B6OPcJ8H.js";import"./index-DPKLIzn_.js";import"./ContextIsolator-CkXzKCb2.js";import"./roundedArrow-BwnxkRYR.js";import"./zoom-4hUM78Wf.js";import"./useLocale-CAcQyQJe.js";import"./render-C8EwcgY9.js";import"./InfoCircleFilled-Diw2lW5Y.js";import"./KeyCode-DNlgD2sM.js";import"./useCSSVarCls-8fHlreE3.js";async function Y(s){return(await axios.put("/api/repair/"+s.id,s)).data}async function Z(s,o){return(await axios.put("/api/unrepair/"+s,o)).data}function ke(){var h,x,g,_,y,b,j,R,v,C,w,E,S,U,A;const[s,o]=p.useState({}),{ticket:e}=I(t=>t.tickets),{user:d}=I(t=>t.app),[F,l]=p.useState(!1),[T,u]=p.useState(!1);K(),p.useEffect(()=>{var t,r;o({...e.decision_making,repair_cost:((t=e==null?void 0:e.repair)==null?void 0:t.repair_cost)??e.repair_cost,notes:((r=e==null?void 0:e.repair)==null?void 0:r.notes)??e.notes,asc_data:e.asc})},[]);function f(t,r){o(r==="repair_cost"?{...s,repair_cost:t.replace(/[^0-9.]/g,"")}:{...s,[r]:t})}async function D(t){if(confirm("Are you sure you want to mark as repaired the ticket?")){l(!0);try{const r=await Y({...s,account:d,status:"REPAIR SUCCESS"});l(!1),L.visit(N("files"))}catch{l(!1)}}}function q(t){return new Promise((r,n)=>{const i=new FileReader;i.readAsDataURL(t),i.onload=()=>r(i.result),i.onerror=c=>n(c)})}async function B(t){if(confirm("Are you sure you want to mark as unrepair the ticket?")){u(!0);try{const r={...s,account:d,status:"REPAIR UNSUCCESSFUL"},n=await Z(s.ticket_id,r);console.log("result",n),u(!1),L.visit(N("decision"))}catch{u(!1)}}}let m=!1;async function M(t){var r;if(!m){m=!0;try{const n=(r=t.fileList)==null?void 0:r.map(z=>{const G=z.originFileObj;return q(G)}),i=await Promise.all(n),c=await Q({attachments:i,ticket_id:e.ticket_id});(c==null?void 0:c.status)==200?(k.success("Uploaded attachment"),console.log("base64Strings",i)):k.error("Upload failed. Please try again.")}catch{}finally{m=!1}}}console.log("ticketticket",e==null?void 0:e.repair_files);const O=(h=e==null?void 0:e.repair_files)==null?void 0:h.map((t,r)=>({uid:r,name:t.file,url:t.file,status:"done"}));return a.jsxs("div",{className:"flex flex-col gap-6",children:[a.jsxs("div",{children:["ASC Name: ",((g=(x=e.asc)==null?void 0:x.user)==null?void 0:g.name)??"None"]}),a.jsxs("div",{children:["Address: ",((y=(_=e.asc)==null?void 0:_.user)==null?void 0:y.address)??"",","," ",((j=(b=e.asc)==null?void 0:b.user)==null?void 0:j.city)??"",", ",((v=(R=e.asc)==null?void 0:R.user)==null?void 0:v.state)??"",","," ",((w=(C=e.asc)==null?void 0:C.user)==null?void 0:w.zip_code)??""," Canada"]}),a.jsxs("div",{children:["Email: ",((S=(E=e.asc)==null?void 0:E.user)==null?void 0:S.email)??""]}),a.jsxs("div",{children:["Phone: ",((A=(U=e.asc)==null?void 0:U.user)==null?void 0:A.phone)??""]}),a.jsx(V,{method:"GET",action:"https://660d2bd96ddfa2943b33731c.mockapi.io/api/upload",listType:"picture",defaultFileList:O,multiple:!0,onChange:M,children:a.jsx(W,{type:"primary",icon:a.jsx(X,{}),children:"Upload Attachments"})}),a.jsx(H,{onChange:f,name:"repair_cost",required:!0,value:(s==null?void 0:s.repair_cost)??" ",label:"Repair Cost",type:"text",errorMessage:"Repair Cost is required"}),a.jsx(J,{required:!0,onChange:f,name:"notes",value:(s==null?void 0:s.notes)??" ",label:"notes",type:"text",errorMessage:"notes is required"}),a.jsxs("div",{className:"flex gap-4",children:[a.jsx("button",{onClick:D,className:"p-2 bg-blue-500 hover:bg-blue-600 text-white rounded-md",children:F?a.jsx(P,{}):"REPAIRED"}),a.jsx("button",{onClick:B,className:"p-2 bg-red-500 hover:bg-red-600 text-white rounded-md",children:T?a.jsx(P,{}):" NOT REPAIRED"})]})]})}export{ke as default};
